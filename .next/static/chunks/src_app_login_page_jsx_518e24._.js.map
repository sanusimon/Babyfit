{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/My%20files/Babyfit/babyfit-next/latest/shoping/src/app/login/page.jsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useState } from \"react\";\nimport \"./login.scss\";\nimport { LoginState } from \"@wix/sdk\";\nimport { useWixClient } from \"@/hooks/useWixClient\";\nimport Cookies from \"js-cookie\";\nimport { useRouter } from \"next/navigation\";\n\nconst MODE = {\n  LOGIN: \"LOGIN\",\n  REGISTER: \"REGISTER\",\n  RESET_PASSWORD: \"RESET_PASSWORD\",\n  EMAIL_VERIFICATION: \"EMAIL_VERIFICATION\",\n};\n\nconst LoginPage = () => {\n\n  const wixClient = useWixClient();\n  const router = useRouter();\n  \n\n  const isLoggedIn = wixClient.auth.loggedIn();\n \n  useEffect(() => {\n    if (isLoggedIn) {\n      router.push(\"/\");\n    }\n  }, [isLoggedIn, router]); // Add router and isLoggedIn to dependencies\n  // if(isLoggedIn){\n  //   router.push(\"/\")\n  // }\n\n  const [username, setUserName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [emailcode, setEmailCode] = useState(\"\");\n  const [mode, setMode] = useState(MODE.LOGIN);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n\n \n\n  const formTitle =\n    mode === MODE.LOGIN\n      ? \"Log in\"\n      : mode === MODE.REGISTER\n      ? \"Register\"\n      : mode === MODE.RESET_PASSWORD\n      ? \"Reset your password\"\n      : \"Verify your Email\";\n\n  const buttonTitle =\n    mode === MODE.LOGIN\n      ? \"Login\"\n      : mode === MODE.REGISTER\n      ? \"Register\"\n      : mode === MODE.RESET_PASSWORD\n      ? \"Reset\"\n      : \"Verify\";\n\n  \n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n    setMessage(\"\");\n    try {\n      let response;\n      switch (mode) {\n        case MODE.LOGIN:\n          response = await wixClient.auth.login({ email, password });\n          setMessage(\"Login successful!\");\n          break;\n\n        case MODE.REGISTER:\n          response = await wixClient.auth.register({\n            email,\n            password,\n            profile: { nickname: username },\n          });\n          setMessage(\"Registration successful! Please verify your email.\");\n          break;\n\n        case MODE.RESET_PASSWORD:\n          response = await wixClient.auth.sendPasswordResetEmail(email, window.location.href);\n          setMessage(\"Password reset email sent. Please check your e-mail\");\n          break;\n\n        case MODE.EMAIL_VERIFICATION:\n          response = await wixClient.auth.processVerification({\n            verificationCode: emailcode,\n          });\n          setMessage(\"Email verified successfully!\");\n          break;\n\n        default:\n          throw new Error(\"Invalid mode\");\n      }\n\n      console.log(response)\n\n      switch(response?.loginState){\n        case LoginState.SUCCESS:\n            setMessage(\"Successfull! You are being redirected\");\n           \n            const tokens = await wixClient.auth.getMemberTokensForDirectLogin(response.data.sessionToken)\n      \n        \n      \n            \n            Cookies.set(\"refreshToken\",JSON.stringify(tokens.refreshToken),{\n              expires:2\n            })\n            \n            wixClient.auth.setTokens(tokens);\n      \n            router.push(\"/\");\n\n            \n            break;\n\n            case LoginState.FAILURE:\n              if(response.errorCode === \"invalidEmail\" || response.errorCode === \"invalidPassword\"){\n                setError(\"Invalid email or password\")\n              }\n              else if(response.errorCode === \"emailAlreadyExist\"){\n                setError(\"Email already exist\")\n              }\n              else if(response.errorCode === \"resetPassword\"){\n                setError(\"You need to reset your password!\")\n              }{\n                setError(\"Something went wrong\")\n              }\n              case LoginState.EMAIL_VERIFICATION_REQUIRED:\n                setMode(MODE.EMAIL_VERIFICATION);\n              case LoginState.OWNER_APPROVAL_REQUIRED:\n              setMessage(\"Your account is pending approval\")\n\n            default:\n                break\n      }\n\n\n\n    } catch (err) {\n      setError(\"Something went wrong. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n   // AUTH WITH WIX-MANAGED AUTH\n\n  // const wixClient = useWixClient();\n\n  // const login = async () => {\n  //   const loginRequestData = wixClient.auth.generateOAuthData(\n  //     \"http://localhost:3000\"\n  //   );\n\n  //   console.log(loginRequestData);\n\n  //   localStorage.setItem(\"oAuthRedirectData\", JSON.stringify(loginRequestData));\n  //   const { authUrl } = await wixClient.auth.getAuthUrl(loginRequestData);\n  //   window.location.href = authUrl;\n  // };\n\n\n  return (\n    <section className=\"login_page\">\n      <div className=\"container\">\n        {/* <button onClick={login}>login</button> */}\n        <form className=\"login_box\" onSubmit={handleSubmit}>\n          <h2 className=\"title\">{formTitle}</h2>\n          <div className=\"form_\">\n            {mode === MODE.REGISTER && (\n              <div className=\"form_control\">\n                <label>Username</label>\n                <input\n                  type=\"text\"\n                  placeholder=\"John\"\n                  name=\"username\"\n                  onChange={(e) => setUserName(e.target.value)}\n                />\n              </div>\n            )}\n\n            {mode !== MODE.EMAIL_VERIFICATION ? (\n              <div className=\"form_control\">\n                <label>Email</label>\n                <input\n                  type=\"email\"\n                  placeholder=\"john@gmail.com\"\n                  name=\"email\"\n                  onChange={(e) => setEmail(e.target.value)}\n                />\n              </div>\n            ) : (\n              <div className=\"form_control\">\n                <label>Verification Code</label>\n                <input\n                  type=\"text\"\n                  placeholder=\"Code\"\n                  name=\"emailcode\"\n                  onChange={(e) => setEmailCode(e.target.value)}\n                />\n              </div>\n            )}\n\n            {(mode === MODE.LOGIN || mode === MODE.REGISTER) && (\n              <div className=\"form_control\">\n                <label>Password</label>\n                <input\n                  type=\"password\"\n                  placeholder=\"Enter password\"\n                  name=\"password\"\n                  onChange={(e) => setPassword(e.target.value)}\n                />\n              </div>\n            )}\n\n            {mode === MODE.LOGIN && (\n              <span className=\"frgt_txt\" onClick={() => setMode(MODE.RESET_PASSWORD)}>\n                Forgot Password?\n              </span>\n            )}\n\n            <button className=\"cmnBtn\" disabled={isLoading}>\n              {isLoading ? \"Loading...\" : buttonTitle}\n            </button>\n\n            {error && <div className=\"error\">{error}</div>}\n\n            {mode === MODE.LOGIN && (\n              <span className=\"frgt_txt\" onClick={() => setMode(MODE.REGISTER)}>\n                Don't have an account?\n              </span>\n            )}\n\n            {mode === MODE.REGISTER && (\n              <div className=\"text-sm underline cursor-pointer\" onClick={() => setMode(MODE.LOGIN)}>\n                Have an account?\n              </div>\n            )}\n\n            {mode === MODE.RESET_PASSWORD && (\n              <div className=\"text-sm underline cursor-pointer\" onClick={() => setMode(MODE.LOGIN)}>\n                Go back to Login\n              </div>\n            )}\n\n            {message && <div className=\"text-green-600 text-sm\">{message}</div>}\n          </div>\n        </form>\n      </div>\n    </section>\n  );\n};\n\nexport default LoginPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}